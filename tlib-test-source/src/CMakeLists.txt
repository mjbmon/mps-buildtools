cmake_minimum_required(VERSION 3.20)
set(CMAKE_CXX_STANDARD 17)

# Following are scanned by configure
set(THE_PROJECT_NAME "mps-tlib-test")
set(THE_PROJECT_MAJOR "1")
set(THE_PROJECT_MINOR "1")
set(THE_PROJECT_MICRO "1")
set(THE_PROJECT_APP "thello")

set(PROJECT_VERSION_STRING "${THE_PROJECT_MAJOR}.${THE_PROJECT_MINOR}.${THE_PROJECT_MICRO}" )
message("VER ${PROJECT_VERSION_STRING}")
project(${THE_PROJECT_NAME}  VERSION "${PROJECT_VERSION_STRING}" )

# Get the library from source
set(TMISC_TOP $ENV{HOME}/Git/mps-thello/tlib )

include(FetchContent)
FetchContent_Declare(mps-tlib
   SOURCE_DIR "${TMISC_TOP}/src"
)
FetchContent_MakeAvailable(mps-tlib)



set(APP ${THE_PROJECT_APP})

add_executable(${APP})
target_sources(${APP} PRIVATE thello.cc thlib/thlib.h thlib/thlib.cc )
include_directories(${APP}  $<BUILD_INTERFACE:${${APP}_SOURCE_DIR}> )

# Generate the version header ${APP}-version.h in CMAKE_BINARY_DIR)/lib
file(GENERATE OUTPUT ${APP}-version.h
     CONTENT "\
  /*  This file generated by CMake */\n\
  static const char *${APP}_NAME = \"${APP}\";\n\
  static const char *${APP}_MAJOR = \"${THE_PROJECT_MAJOR}\";\n\
  static const char *${APP}_MINOR = \"${THE_PROJECT_MINOR}\";\n\
  static const char *${APP}_MICRO = \"${THE_PROJECT_MICRO}\";\n\
")

target_include_directories(${APP} PRIVATE ${CMAKE_BINARY_DIR})

target_link_libraries(${APP} PUBLIC tmisc)

install(TARGETS ${APP} RUNTIME DESTINATION bin )
